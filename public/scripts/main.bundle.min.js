(()=>{"use strict";const e="terms-container",t=e=>"[object Number]"===Object.prototype.toString.call(e),n=(e,n,a)=>{if(t(e)&&t(n)&&t(a)){const t=12*a,r=n/1200;return e*r*Math.pow(1+r,t)/(Math.pow(1+r,t)-1)}return-1},a=(e,n,a,r)=>{if(t(e)&&t(n)&&t(a)&&t(r)){const t=12*r,l=a/1200;let o=0,s=0;for(let a=0;a<=t;a++)s+=n*l,o=e-n*l,n-=o;return s}return-1},r=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}),l={getElement:e=>{const t=document.createElement("div");t.classList.add("results",document.body.classList.contains("light")?"light":"dark");const n=r();for(const[a,r]of Object.entries(e)){const e=document.createElement("div");e.classList.add("results-item");const l=document.createElement("span");l.classList.add("result-span","left"),l.textContent=a;const o=document.createElement("span");o.classList.add("result-span","right","bold"),o.textContent=n.format(r),e.append(l,o),t.appendChild(e)}return t},render:e=>{if(e){const e=document.getElementById("results-container");e&&e.append(l.getElement())}}},o={getElement:(e,t=null)=>{const n=document.createElement("div");return n.classList.add("content-header","light-mode","flex","align-items-center"),n.innerText=e,t&&n.append(t),n},render:(t=e)=>{const n=document.getElementById(t);n&&n.append(o.getElement())}},s={getElement:(e=[1,2,3])=>{const t=document.createElement("div");t.classList.add("overflow-table");const n=document.createElement("table");if(Array.isArray(e)&&e.length){const a=document.createElement("tr"),l=document.createElement("th"),o=document.createElement("th"),s=document.createElement("th"),c=document.createElement("th"),d=document.createElement("th"),i=document.createElement("th"),m=document.createElement("th");l.textContent="Year",o.textContent="Month",s.textContent="Interest",c.textContent="Principal",d.textContent="Balance",i.textContent="Total Interest",m.textContent="Total Principal",a.append(l,o,s,c,d,i,m),n.appendChild(a);const u=r();let h=!1;e.forEach((e=>{const a=document.createElement("tr");!h&&e.totalInterest<e.totalPrincipal&&(a.classList.add("bd-bottom-green"),h=!0);const r=document.createElement("td");r.textContent=e.year;const l=document.createElement("td");l.textContent=e.month;const o=document.createElement("td");o.textContent=u.format(e.interest);const s=document.createElement("td");s.textContent=u.format(e.principal);const c=document.createElement("td");c.textContent=u.format(e.balance);const d=document.createElement("td");d.classList.add("grey-border-left","grey-bg"),d.textContent=u.format(e.totalInterest);const i=document.createElement("td");i.classList.add("grey-border-right","grey-bg"),i.textContent=u.format(e.totalPrincipal),a.append(r,l,o,s,c,d,i),n.appendChild(a),t.appendChild(n)})),(e=>{const t=document.querySelectorAll(`.${e}`);for(const n of t)n.classList.remove(e)})("d-none")}return t},render:e=>{if(e){const t=document.getElementById(e);t&&t.append(s.getElement())}}},c={getChartElementContainer:()=>{const e=document.createElement("cavnas");return e.classList.add("m-auto","h-300"),e.id="chart-container",e},render:e=>{const t=document.getElementById("visual-container");t.removeChild(t.firstChild),t.prepend(o.getElement("Visualization"));document.getElementById("chart-container")&&(t.lastChild&&(t.removeChild(t.lastChild),t.appendChild(c.getChartElementContainer())),Chart.getChart("chart-container")&&Chart.getChart("chart-container").destroy(),new Chart(document.getElementById("chart-container"),{type:"doughnut",data:{labels:["Interest","Principal"],datasets:[{label:"My First Dataset",data:e,backgroundColor:["rgb(243, 196, 219)","rgb(196, 243, 220)"],hoverOffset:4}]},options:{plugins:{tooltip:{callbacks:{label:function(e){return console.log(e),`${e.label||""}: ${r().format(e.parsed)}`}}}}}}))}};let d=!1,i=!1,m=!1,u=!1;const h=e=>{const t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let t=0;t<e.length;t++)n[t]=255&e.charCodeAt(t);return t},g={loadEventListeners:()=>{},downloadExcel:(e,t,n)=>{const a=[["Year","Month","Interest","Principal","Balance","TotalInterest","TotalPrincipal"]];n.forEach((e=>{a.push([e.year,e.month,e.interest,e.principal,e.balance,e.totalInterest,e.totalPrincipal])}));const r=XLSX.utils.aoa_to_sheet(a),l=XLSX.utils.book_new();XLSX.utils.book_append_sheet(l,r,"Sheet1");const o=XLSX.write(l,{bookType:"xlsx",type:"binary"}),s=new Blob([h(o)],{type:"application/octet-stream"}),c=document.createElement("a");c.href=URL.createObjectURL(s),c.download=`amortization_schedule_${(new Date).toJSON().slice(0,10)}_.xlsx`,c.click()},submitHandler:e=>{e.preventDefault();const r=document.getElementById("terms-container");r.classList.contains("m-auto")&&(r.classList.remove("m-auto"),r.classList.add("m-15"));const d=Number(document.getElementById("loanAmount").value),i=Number(document.getElementById("interestRate").value),m=Number(document.getElementById("loanTerm").value),u=Number(document.getElementById("extraMonthlyPayment").value),h=m<=50?m:50;if(document.getElementById("loanTerm").value=h,console.log(`Extra payment: ${u}`),d&&i&&m){const e=n(d,i,m);var p=a(e,d,i,m),E=[],b=0,y=0;u&&(E=((e,r,l,o)=>{if(t(e)&&t(r)&&t(l)&&t(o)){const t=n(e,r,l),s=a(t,e,r,l);let c=0,d=0,i=0,m=0,u=0,h=12*l;const g=r/1200,p=[];for(let n=1;n<=l;n++)for(let n=1;n<=12;n++){if(c=e*g,i+=c,d=t-c,m+=d+o,d+o>e?(d=e,m+=d,e=0):e-=d+o,e<=0)return p.push({years:(h-u)/12,interest:s-i}),p;u++}return p}return[]})(d,i,m,u)[0],b=E.interest,y=E.years,p-=b),console.log(`Finished ${y} years or ${12*y} months earlier`);const r=((e,n)=>t(e)&&t(n)?e+n:-1)(d,p),h={"Monthly Payment":e,"Total Interest":p,"Total Amount Paid":r,"Interest Saving":b};console.log(h,"resObject");const L=document.getElementById("results-container");for(;L.hasChildNodes();)L.removeChild(L.lastChild);L.appendChild(o.getElement("Payment Results")),L.appendChild(l.getElement(h));const C=document.getElementById("schedule-container");for(;C.hasChildNodes();)C.removeChild(C.lastChild);const k=document.createElement("a");k.href="#",k.id="download-excel",k.classList.add("btn","teal","lighten-3","color-white","ml-auto"),k.textContent="Download Excel";const x=document.createElement("i");x.classList.add("fa-sharp","fa-solid","fa-download","left"),k.prepend(x),C.append(o.getElement("Amortization Schedule",k));var f;f=((e=0,a,r,l)=>{if(t(a)&&t(r)&&t(l)&&t(e)){const t=n(a,r,l);let o=0,s=0,c=0,d=0;const i=r/1200,m=[];for(let n=1;n<=l;n++)for(let r=1;r<=12;r++)if(o=a*i,c+=o,s=t-o,s+e>a?(s=a,d+=s,a=0):(d+=s+e,a-=s+e),m.push({year:n,month:r,interest:o,principal:s,balance:a,totalInterest:c,totalPrincipal:d}),a<=0)return m;return m}return[]})(u,d,i,m),C.appendChild(s.getElement(f));const v=f[f.length-1];localStorage.setItem("results",JSON.stringify(h)),localStorage.setItem("schedule",JSON.stringify(f));const I=document.getElementById("download-excel");I.onclick=e=>{e.preventDefault(),g.downloadExcel(e,h,f)},I.classList.remove("d-none"),setTimeout((()=>{c.render([v.totalInterest,v.totalPrincipal])}),150),console.log(f)}},getInput:(e,t,n="text",a=!1)=>{const r=document.createElement("div");r.classList.add("form-input");const l=document.createElement("label");l.textContent=e;const o=document.createElement("input");return o.type=n,o.name=t,o.id=t,o.onkeyup=((e,t=350)=>{let n;return(...a)=>{clearTimeout(n),n=setTimeout((()=>{e(...a)}),t)}})((e=>{"loanAmount"==t?d=!!o.value:"interestRate"==t?i=!!o.value:"loanTerm"==t?(o.value>50&&(o.value=50),m=!!o.value):"extraMonthlyPayment"==t&&(u=!!o.value),d&&i&&m&&g.submitHandler(e)}),550),a&&(o.required=!0),r.appendChild(l),r.appendChild(o),r},getElement:()=>{const{getInput:e}=g,t=document.createElement("form");t.classList.add("loan-form");const n=e("Loan Amount:","loanAmount","number",!0),a=e("Interest Rate (%):","interestRate","number",!0),r=e("Loan Term (years):","loanTerm","number",!0),l=e("Extra Montly Payment ($):","extraMonthlyPayment","number",!0);n.focus=!0,t.appendChild(n),t.appendChild(a),t.appendChild(r),t.appendChild(l);const o=document.createElement("input");return o.classList.add("btn","teal","lighten-3"),o.type="submit",o.value="Calculate",o.onclick=e=>g.submitHandler(e),t.appendChild(o),{element:t,callback:e=>{setTimeout((()=>{loanAmount.focus()}),100)}}},render:(t=e)=>{const n=document.getElementById(t);if(n){const{element:e,callback:t}=g.getElement(n);n.appendChild(e),t&&t()}}},p={currentPage:1,totalPages:2,render:(t=e)=>{const n=[],{currentPage:a,totalPages:r}=p,l=document.getElementById(t);if(l){l.append(o.getElement("Loan Terms"));const{element:e,callback:t}=g.getElement(l);return t&&n.push(t),l.appendChild(e),n}}};let E=!0;const b={toggleMode:e=>{setTimeout((e=>{E=!E,E?(e=>{const t=document.querySelector("body"),n=document.querySelectorAll(".content-header"),a=document.querySelectorAll(".container"),r=document.querySelectorAll(".results"),l=document.getElementById("top-bar");t&&t.classList.contains("dark")&&(t.style.backgroundColor="var(--light-grey-bg)",t.classList.remove("dark"),t.classList.add("light")),l&&l.classList.contains("dark")&&(l.classList.remove("dark","dark-header-bg","dark-header-txt"),l.classList.add("light","light-header-bg","light-header-txt")),n&&n[0].classList.contains("dark")&&n.forEach((e=>{e.classList.contains("dark")&&(e.classList.remove("dark"),e.classList.remove("dark","dark-header-bg","dark-header-txt"),e.classList.add("light","light-header-bg","light-header-txt"))})),a&&a[0].classList.contains("dark")&&a.forEach((e=>{e.classList.contains("dark")&&(e.classList.remove("dark","dark-container-bg","dark-container-txt","dark-container-border"),e.classList.add("light","light-container-bg","light-container-txt","light-container-border"))})),r&&r.length&&r[0]&&r.forEach((e=>{e.classList.contains("dark")&&(e.classList.remove("dark","dark-results-bg","dark-results-txt","dark-results-border"),e.classList.add("light","light-results-bg","light-results-txt","light-results-border"))}))})():(e=>{const t=document.querySelector("body"),n=document.querySelectorAll(".content-header"),a=document.querySelectorAll(".container"),r=document.querySelectorAll(".results"),l=document.getElementById("top-bar");t&&t.classList.contains("light")&&(t.style.backgroundColor="var(--dark-bg)",t.classList.remove("light"),t.classList.add("dark")),l&&l.classList.contains("light")&&(l.classList.remove("light","light-header-bg","light-header-txt"),l.classList.add("dark","dark-header-bg","dark-header-txt")),n&&n.length&&n[0].classList.contains("light")&&n.forEach((e=>{e.classList.contains("light")&&(e.classList.remove("light","light-header-bg","light-header-txt"),e.classList.add("dark","dark-header-bg","dark-header-txt"))})),a&&a.length&&a[0].classList.contains("light")&&a.forEach((e=>{e.classList.contains("light")&&(e.classList.remove("light","light-container-bg","light-container-txt","light-container-border"),e.classList.add("dark","dark-container-bg","dark-container-txt","dark-container-border"))})),r&&r.length&&r[0]&&r.forEach((e=>{e.classList.contains("light")&&(e.classList.remove("light","light-results-bg","light-results-txt","light-results-border"),e.classList.add("dark","dark-results-bg","dark-results-txt","dark-results-border"))}))})()}),100)},getElement:()=>{const e=document.createElement("div");e.classList.add("top-bar");const t=document.createElement("h1");t.textContent="MortiSmart";const n=document.createElement("div");n.id="toggle-container";const a=document.createElement("i");a.id="toggle",a.classList.add("light-mode","toggle","fa-regular","fa-sun"),n.onclick=e=>{b.toggleMode(e)};const r=document.createElement("label");return r.classList.add("switch"),r.innerHTML=' <input id="toggle-input" type="checkbox"><span class="slider round"></span>',r.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation();const t=document.getElementById("toggle-input");t.checked=!t.checked,b.toggleMode(e)})),n.appendChild(r),e.appendChild(t),e.appendChild(n),e},render:(e="top-bar")=>{const t=document.getElementById(e);t&&t.append(b.getElement())}},y={getElement:()=>{const e=document.createElement("div");return e.classList.add("footer"),e},render:(e="footer")=>{const t=document.getElementById(e);t&&t.append(y.getElement())}};(e=>{const{topBar:t,footer:n,ui:a}=e;t.render(),n.render();const r=a.render();r&&r.forEach((e=>{"function"==typeof e&&e()}))})({topBar:b,ui:{render:(t=e)=>{if(document.getElementById(t))return p.render()}},footer:y})})();